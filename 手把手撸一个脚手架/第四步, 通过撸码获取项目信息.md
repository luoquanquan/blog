ç³»åˆ—æ–‡ç« :

- [ã€æ‰‹æŠŠæ‰‹æ’¸ä¸€ä¸ªè„šæ‰‹æ¶ã€‘ç¬¬ä¸€æ­¥, åˆ›å»ºç¬¬ä¸€ä¸ªå‘½ä»¤](https://juejin.im/post/5bead1b25188251e1a1f4d34)
- [ã€æ‰‹æŠŠæ‰‹æ’¸ä¸€ä¸ªè„šæ‰‹æ¶ã€‘ç¬¬äºŒæ­¥, æ­å»ºå¼€å‘ç¯å¢ƒ](https://juejin.im/post/5bec24ddf265da61171c4a34)
- [ã€æ‰‹æŠŠæ‰‹æ’¸ä¸€ä¸ªè„šæ‰‹æ¶ã€‘ç¬¬ä¸‰æ­¥, è·å– github é¡¹ç›®ä¿¡æ¯](https://juejin.im/post/5bec598d51882579117f61f8)
- [ã€æ‰‹æŠŠæ‰‹æ’¸ä¸€ä¸ªè„šæ‰‹æ¶ã€‘ç¬¬å››æ­¥, é€šè¿‡æ’¸ç è·å–é¡¹ç›®ä¿¡æ¯](https://juejin.im/post/5bed6ff2f265da61137ed948)

> å‰é¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬å·²ç»èƒ½å¤Ÿè·å–åˆ°å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‚æ•°, ä¹Ÿèƒ½é€šè¿‡ gayhub å¼€æ”¾ api ä¸­è·å–åˆ°é¡¹ç›®æ¨¡æ¿ä¿¡æ¯, è¿™é‡Œæˆ‘ä»¬å¼€å§‹æŠŠä¹‹å‰çš„åŠŸèƒ½è¿ç¼€èµ·æ¥ ^_^

![2018-11-15-15-37-26](https://user-gold-cdn.xitu.io/2018/11/15/167177e0f4c6d88f?w=550&h=586&f=png&s=271183)

æœ¬èŠ‚ç”¨åˆ°çš„å·¥å…·è¾ƒå¤š, list ä¸€å“ˆ:

- è·å–å‘½ä»¤è¡ŒæŒ‡ä»¤ [commander](https://www.npmjs.com/package/commander)
- å‘½ä»¤è¡Œäº¤äº’å·¥å…· [inquirer.js](https://github.com/SBoudrias/Inquirer.js#documentation)
- å‘½ä»¤è¡Œæ˜¾ç¤ºåŠ è½½ä¸­ [ora](https://www.npmjs.com/package/ora)
- ajax å°è£…åº“ [axios](https://www.npmjs.com/package/axios)

## é¦–å…ˆå±•ç¤ºä¸€ä¸‹ç›®å½•ç»“æ„[ä»£ç åœ°å€](https://github.com/luoquanquan/learn-cli/tree/0.0.1)

![2018-11-15-20-19-15](https://user-gold-cdn.xitu.io/2018/11/15/167177e0f4b1ca18?w=2560&h=1600&f=png&s=227998)

## å„ä¸ªæ–‡ä»¶ä»‹ç»

bin/learn.js

```js
#!/usr/bin/env node
require('../');
```

ä»ç„¶ä½œä¸ºé¡¹ç›®çš„å¼•å¯¼æ–‡ä»¶, ç›´æ¥å¼•å…¥é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ index.js

index.js

```js
require('babel-register');
const babel = require('@babel/core');
const babelPresetLatestNode = require('babel-preset-latest-node');

babel.transform('code();', {
  presets: [[babelPresetLatestNode, {
    target: 'current',
  }]],
});

require('babel-polyfill');
require('./src');
```

æ ¹ç›®å½•ä¸‹çš„ index ä½œä¸ºé¡¹ç›®çš„å…¥å£æ–‡ä»¶, å®ƒçš„èŒè´£ä¸»è¦æ˜¯å…¼å®¹ es6, å¹¶å¯¼å…¥é¡¹ç›®ä¸»æ–‡ä»¶ `src/index.js`

src/index.js

```js
// colors console.log æ–‡æœ¬æ·»åŠ å­—ä½“é¢œè‰², ç¾è§‚
import 'colors';

// æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°, æä¾›åŸºç¡€ä¿¡æ¯æç¤ºåŠŸèƒ½
import commander from 'commander';

// å†…éƒ¨æ¨¡å—
import { existsSync } from 'fs';
import { resolve } from 'path';
import { version } from '../package.json';

commander.version(version)
  .parse(process.argv);

// è·å–å‘½ä»¤è¡Œä¸­ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°
const [todo = ''] = commander.args;

// åˆ¤æ–­å¦‚æœ command ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å¯¹åº”çš„æ–‡ä»¶
if (existsSync(resolve(__dirname, `command/${todo}.js`))) {
  require(`./command/${todo}.js`);
} else {
  console.log(
    `
      ä½ è¾“å…¥äº†æœªçŸ¥æŒ‡ä»¤, å°å“¥å“¥æˆ‘å·²ç»å—ä¸äº†æŒ‚äº†...
    `.red,
  );
  process.exit(-1);
}
```

è¿™ä¸ªæ˜¯é¡¹ç›®çš„ä¸»æ–‡ä»¶, ä¹Ÿæ˜¯æ•´ä¸ªç¨‹åºçš„**æ€»æ§**. æ­£å¦‚æ³¨é‡Š, æ‰§è¡Œå‘½ä»¤å‰, ä»è¿™é‡Œæ£€æµ‹æˆ‘ä»¬çš„å‘½ä»¤ç›®å½•ä¸‹æ˜¯å¦å·²ç»å­˜åœ¨äº†ç”¨æˆ·è¯·æ±‚çš„å‘½ä»¤, é¿å…äº†ç”¨æˆ·è¯¯æ“ä½œç¨‹åºæŠ¥é”™çš„é£é™©.

command/download.js

```js
// å‘½ä»¤ç®¡ç†
import commander from 'commander';
// å‘½ä»¤è¡Œäº¤äº’å·¥å…·
import inquirer from 'inquirer';
// å‘½ä»¤è¡Œä¸­æ˜¾ç¤ºåŠ è½½ä¸­
import ora from 'ora';
import Git from '../tools/git';

class Download {
  constructor() {
    this.git = new Git();
    this.commander = commander;
    this.inquirer = inquirer;
    this.getProList = ora('è·å–é¡¹ç›®åˆ—è¡¨...');
    this.getTagList = ora('è·å–é¡¹ç›®ç‰ˆæœ¬...');
    this.downLoad = ora('æ­£åœ¨åŠ é€Ÿä¸ºæ‚¨ä¸‹è½½ä»£ç ...');
  }

  run() {
    this.commander
      .command('download')
      .description('ä»è¿œç¨‹ä¸‹è½½ä»£ç åˆ°æœ¬åœ°...')
      .action(() => { this.download(); });

    this.commander.parse(process.argv);
  }

  async download() {
    let getProListLoad;
    let getTagListLoad;
    let repos;
    let version;
    try {
      getProListLoad = this.getProList.start();
      repos = await this.git.getProjectList();
      getProListLoad.succeed('è·å–é¡¹ç›®åˆ—è¡¨æˆåŠŸ');
    } catch (error) {
      console.log(error);
      getProListLoad.fail('è·å–é¡¹ç›®åˆ—è¡¨å¤±è´¥...');
      process.exit(-1);
    }
    if (repos.length === 0) {
      console.log('\nå¯ä»¥å¼€å‘çš„é¡¹ç›®æ•°ä¸º 0, è‚¯å®šæ˜¯é…ç½®é”™å•¦~~\n'.red);
      process.exit(-1);
    }
    const choices = repos.map(({ name }) => name);
    const questions = [
      {
        type: 'list',
        name: 'repo',
        message: 'è¯·é€‰æ‹©ä½ æƒ³è¦å¼€å‘çš„é¡¹ç›®ç±»å‹',
        choices,
      },
    ];
    const { repo } = await this.inquirer.prompt(questions);
    // è·å–é¡¹ç›®çš„ç‰ˆæœ¬, è¿™é‡Œé»˜è®¤é€‰æ‹©ç¡®å®šé¡¹ç›®çš„æœ€è¿‘ä¸€ä¸ªç‰ˆæœ¬
    try {
      getTagListLoad = this.getTagList.start();
      [{ name: version }] = await this.git.getProjectVersions(repo);
      getTagListLoad.succeed('è·å–é¡¹ç›®ç‰ˆæœ¬æˆåŠŸ');
    } catch (error) {
      console.log(error);
      getTagListLoad.fail('è·å–é¡¹ç›®ç‰ˆæœ¬å¤±è´¥...');
      process.exit(-1);
    }

    console.log(`æ‚¨é€‰æ‹©çš„é¡¹ç›®æ˜¯${repo}, å³å°†ä¸‹è½½ç‰ˆæœ¬${version}`);
  }
}
const D = new Download();
D.run();
```

command ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æˆ‘ä»¬æ•´ä¸ªé¡¹ç›®ä¸­æ‰€æœ‰çš„å‘½ä»¤æ–‡ä»¶, ä¸åŒçš„å‘½ä»¤å¯¹åº”ä¸åŒçš„æ–‡ä»¶, ä½“ç°äº†å•ä¸€èŒè´£çš„è®¾è®¡. download å‘½ä»¤ç”¨åˆ°äº†æˆ‘ä»¬ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„ä¸¤ä¸ªæ¥å£(å³è·å–é¡¹ç›®åˆ—è¡¨å’Œè·å–ç‰ˆæœ¬å·åˆ—è¡¨)æœ‰ç–‘é—®çš„åŒå­¦è¯·å›å¤´å‚è€ƒç³»åˆ—æ–‡ç« ç¬¬ä¸‰æ­¥ ^_^.

tools/git.js

```js
import request from './request';
import { orgName } from '../../config';

class Git {
  constructor() {
    this.orgName = orgName;
  }

  getProjectList() {
    return request(`/orgs/${this.orgName}/repos`);
  }

  getProjectVersions(repo) {
    return request(`/repos/${this.orgName}/${repo}/tags`);
  }

  getProjectUrl() {

  }

  downloadProject() {

  }
}

export default Git;
```

æ­¤æ–‡ä»¶æ˜¯ git ç›¸å…³çš„æ“ä½œçš„æ–‡ä»¶, ç”±äºè„šæ‰‹æ¶çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯è·å–é¡¹ç›®çš„ github åœ°å€, å¹¶ä¸‹è½½, æ‰€ä»¥æˆ‘çš„ Git ç±»è§„åˆ’äº†ä»¥ä¸Šå‡ ä¸ªåŠŸèƒ½, `è·å–é¡¹ç›®åˆ—è¡¨ è·å–é¡¹ç›®ç‰ˆæœ¬å·åˆ—è¡¨ è·å–é¡¹ç›®åœ°å€ ä¸‹è½½é¡¹ç›®`, è™½ç„¶åä¸¤ä¸ªåŠŸèƒ½åœ¨è¿™ä¸€èŠ‚è¿˜ç”¨ä¸åˆ°, æˆ‘ä¹Ÿå…ˆç•™ä¸‹äº†ä»£ç æ¡©

tools/request.js

```js
import axios from 'axios';
import { baseURL } from '../../config';

const instance = axios.create({
  baseURL,
  timeout: 1e4,
});

// Add a request interceptor
instance.interceptors.request.use(config => config,
  error => Promise.reject(error));

// Add a response interceptor
instance.interceptors.response.use(response => response.data,
  error => Promise.reject(error));

export default instance;
```

è¿™ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯å¯¹ axios åšäº†ä¸€å±‚ç®€å•çš„å°è£…, å°è£…çš„æ‰‹æ³•æˆ‘è¿˜ä¸æ˜¯æŒæ¡çš„å¾ˆå¥½, å¦‚æœæœ‰ç²¾é€šçš„å°ä¼™ä¼´æ¬¢è¿è¯„è®ºåŒºèµæ•™.
![2018-11-15-20-39-14](https://user-gold-cdn.xitu.io/2018/11/15/167177e0f4921af8?w=588&h=548&f=png&s=299101)

config/index.js

```js
// github æ¥å£åŸºç¡€åœ°å€
export const baseURL = 'https://api.github.com';
// organization åç§°
export const orgName = 'learn-cli-organization';
```

ä½œä¸ºæ•´ä¸ªé¡¹ç›®çš„é…ç½®æ–‡ä»¶, æ‰¿æ‹…äº†ä¿å­˜é¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦çš„é…ç½®ä¿¡æ¯çš„åŠŸèƒ½.

ä»‹ç»å®Œå‡ ä¸ªæ–‡ä»¶, æ„Ÿåˆ°å¦‚é‡Šé‡è´Ÿ. å¦‚æœæœ‰æ‰‹æ‡’çš„å°ä¼™ä¼´, å¯ä»¥ç›´æ¥ github clone [æœ¬é˜¶æ®µä»£ç ](https://github.com/luoquanquan/learn-cli/tree/0.0.1)æŒ‰ç…§ç¬¬ä¸€æ­¥çš„æ–¹æ³•é…ç½®å³å¯

ps: `git clone https://github.com/luoquanquan/learn-cli.git`
ps: `git checkout 0.0.1`
ps: å®Œæˆåè¦æ‰§è¡Œ `npm i` å’Œ `npm link` çš„å“Ÿ ^_^

## éªŒè¯ä»£ç 

ç»ˆäºåˆ°äº†éªŒè¯çš„ç¯èŠ‚. å°ä¼™ä¼´ä»¬, è‡ªå·±å†™å®Œæˆ–è€… git clone å®Œä»£ç ä»¥åå¯ä»¥æ‰“å¼€ç»ˆç«¯å•¦, 484 æœ‰ç‚¹å°å°çš„é¸¡å†» ^_^

![2018-11-15-20-54-10](https://user-gold-cdn.xitu.io/2018/11/15/167177e0f486f0d1?w=536&h=552&f=png&s=207454)

è¾“å…¥ `learn download`

![2018-11-15-20-53-05](https://user-gold-cdn.xitu.io/2018/11/15/167177e0f4aa0ecb?w=758&h=160&f=png&s=48082)

å‡ºç°ä¸Šå›¾æ‰€ç¤ºçš„é¡¹ç›®åç§°å’Œç‰ˆæœ¬å·, è¯´æ˜æˆ‘ä»¬å·²ç»é€šè¿‡ä»£ç è·å– git é¡¹ç›®ä¿¡æ¯æˆåŠŸå•¦.

![2018-11-15-20-57-01](https://user-gold-cdn.xitu.io/2018/11/15/167177e0f4ba4108?w=550&h=550&f=png&s=453756)

ä¸‹é›†é¢„å‘Š: åˆ°ç°åœ¨, æˆ‘ä»¬å·²ç»èƒ½å¤Ÿä» github è·å–åˆ°é¡¹ç›®çš„åç§°å’Œç‰ˆæœ¬å·, ä¸‹ä¸€æ­¥ä¼šå°è¯•æŠŠé¡¹ç›® download åˆ°æœ¬åœ°ç”¨åˆ°äº†å·¥å…· [download-git-repo](https://www.npmjs.com/package/download-git-repo), çƒ­çˆ±åŠ¨æ‰‹çš„å°ä¼™ä¼´å·²ç»å¯ä»¥å¼€å§‹ç€æ‰‹å•¦, è¯´ä¸å®šä¸‹ä¸€æ­¥å°±æ˜¯ä½ æ¥å†™å–² ğŸ˜„
